---
interface Props {
  headings: { depth: number; slug: string; text: string }[];
}

const { headings } = Astro.props;
const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <div class="space-y-4">
    <h4 class="font-display text-sm font-semibold text-white">
      On this page
    </h4>
    <nav>
      <ul class="space-y-2.5 text-sm">
        {filteredHeadings.map((heading) => (
          <li class={heading.depth === 3 ? 'ml-4' : ''}>
            <a
              href={`#${heading.slug}`}
              class="block text-slate-400 hover:text-white transition-colors"
              x-data="{ active: false }"
              x-init="
                const observer = new IntersectionObserver(
                  (entries) => {
                    entries.forEach((entry) => {
                      if (entry.isIntersecting) {
                        active = true;
                      } else {
                        active = false;
                      }
                    });
                  },
                  { rootMargin: '-80px 0px -80% 0px' }
                );
                const target = document.getElementById($el.getAttribute('href').slice(1));
                if (target) observer.observe(target);
              "
              :class="active && 'font-medium text-purple-400'"
            >
              {heading.text}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </div>
)}
