---
import { navigation } from '../../lib/navigation';

const currentPath = Astro.url.pathname;
---

<div
  class="fixed inset-0 z-40 lg:hidden"
  x-show="$store.nav.open"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition ease-in duration-150"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
  x-cloak
>
  <!-- Backdrop -->
  <div
    class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm"
    @click="$store.nav.close()"
  />

  <!-- Sidebar -->
  <div
    class="fixed inset-y-0 left-0 w-full max-w-xs bg-slate-900 shadow-xl"
    x-show="$store.nav.open"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="-translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="-translate-x-full"
  >
    <div class="flex h-16 items-center justify-between px-6 border-b border-slate-800">
      <a href="/" class="flex items-center space-x-2" @click="$store.nav.close()">
        <picture>
          <source srcset="/logo.avif" type="image/avif" />
          <img
            src="/logo.png"
            alt="Achronyme Logo"
            class="h-8 w-8"
            onerror="this.parentElement.style.display='none'; this.parentElement.nextElementSibling.style.display='flex';"
          />
        </picture>
        <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center hidden">
          <span class="text-white font-bold text-sm">A</span>
        </div>
        <span class="font-display text-xl font-semibold text-white">
          Achronyme
        </span>
      </a>
      <button
        type="button"
        class="rounded-md p-2 text-slate-400 hover:bg-slate-800 hover:text-white"
        @click="$store.nav.close()"
      >
        <span class="sr-only">Close menu</span>
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <nav class="overflow-y-auto p-6 space-y-8">
      {navigation.map((section) => (
        <div>
          <h3 class="font-display text-sm font-semibold text-white">
            {section.title}
          </h3>
          <ul class="mt-3 space-y-2">
            {section.items.map((item) => {
              const isActive = currentPath === item.href;
              return (
                <li>
                  <a
                    href={item.href}
                    @click="$store.nav.close()"
                    class:list={[
                      'block text-sm transition-colors',
                      isActive
                        ? 'font-medium text-purple-400'
                        : 'text-slate-400 hover:text-white',
                    ]}
                  >
                    {item.title}
                  </a>
                </li>
              );
            })}
          </ul>
        </div>
      ))}
    </nav>
  </div>
</div>

<style>
  [x-cloak] {
    display: none !important;
  }
</style>
